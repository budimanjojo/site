<!DOCTYPE html>


  
<html itemscope itemtype="https://schema.org/WebPage" class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="siteBaseUrl" content="https://budimanjojo.com/">
    <meta name="author" content="Budiman">
    <meta name="description" content="Life Journey of My Geeky Needs.">
    <meta name="keywords" content="blog,personal,responsive,kubernetes,linux,gitops,fluxcd,dotfiles,cluster,container">
    <meta name="generator" content="Hugo 0.101.0" />
    <title>
        
           
               Raspberry Pi Media Server Series #4 &amp;#8211; Setting Up Docker &vert; Budiman JOJO
           
        
    </title>
    <meta itemprop="name" content="Raspberry Pi Media Server Series #4 &amp;#8211; Setting Up Docker">
    <meta itemprop="description" content="Raspberry Pi Media Server Series #4 &amp;#8211; Setting Up Docker - Life Journey of My Geeky Needs.">
    <meta property="og:title" content="Raspberry Pi Media Server Series #4 &amp;#8211; Setting Up Docker">
    <meta property="og:description" content="Raspberry Pi Media Server Series #4 &amp;#8211; Setting Up Docker - Life Journey of My Geeky Needs.">
    <meta property="og:image" content="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?size=200">
    <meta property="og:url" content="https://budimanjojo.com/2019/12/18/raspberry-pi-media-server-series-4-setting-up-docker/">
    <meta property="og:site_name" content="Budiman JOJO">
    <meta property="og:type" content="article">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">


    <script src="/modernizr-simple.js"></script>

    
    <link href="/2019/12/18/raspberry-pi-media-server-series-4-setting-up-docker/" rel="alternate" type="application/rss+xml" title="Budiman JOJO" />
    <link href="/2019/12/18/raspberry-pi-media-server-series-4-setting-up-docker/" rel="feed" type="application/rss+xml" title="Budiman JOJO" />
    

    
    <link rel="canonical" href="https://budimanjojo.com/2019/12/18/raspberry-pi-media-server-series-4-setting-up-docker/">
    

    <link rel="stylesheet" href="https://budimanjojo.com/theme.css">

    

    
        
    
</head>

<body class="bilberry-hugo-theme">

    
    <nav>

    <div class="container">
        <ul class="topnav">
            
        </ul>

        
            <div id="search-box" class="search">
                <i class="fas fa-search"></i>
                <input id="search" type="text" placeholder="Search ...">
            </div>
        
    </div>
</nav>


    
    <header>

    <div class="container">
        <div class="logo">
            <a href="/" class="logo">
                
                    <img src="/avatar.png" alt="">
                

                <span class="overlay"><i class="fa fa-home"></i></span>
            </a>
        </div>
        <div class="titles">
            <h3 class="title">
                <a href="/">
                    Budiman JOJO
                </a>
            </h3>

            
                <span class="subtitle">Life Journey of My Geeky Needs.</span>
            
        </div>

        

        
            <div class="toggler">
        
                <i class="fa fa-bars" aria-hidden="true"></i>
            </div>
    </div>
</header>


    <div class="main container">
        
    <div class="article-wrapper u-cf single">
        
            <a class="bubble" href="https://budimanjojo.com/2019/12/18/raspberry-pi-media-server-series-4-setting-up-docker/">
    <i class="fas fa-fw fa-pencil-alt"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h1 class="article-title">
        <a href="https://budimanjojo.com/2019/12/18/raspberry-pi-media-server-series-4-setting-up-docker/">
            Raspberry Pi Media Server Series #4 &amp;#8211; Setting Up Docker
        </a>
    </h1>

    <div class="meta">
        
            
                <span class="date moment">2019-12-18</span>
            
        

        

        
            <span class="categories">
                
                    
                    
                        <a href="https://budimanjojo.com/categories/linux/">Linux</a>
                    
                
                    
                    
                        <a href="https://budimanjojo.com/categories/raspberry-pi/">Raspberry Pi</a>
                    
                
                    
                    
                        <a href="https://budimanjojo.com/categories/self-hosted/">Self Hosted</a>
                    
                
            </span>
        

        
            <span class="author">
                
                
                    <a href="https://budimanjojo.com/author/budimanjojo/">budimanjojo</a>
                
            </span>
        
    </div>

    
        

        <h2 id="raspberry-pi-setting-up-dockerhttpsbudimanjojocomwp-contentuploads201912raspberry-pi-media-server-4jpg"><img src="https://budimanjojo.com/wp-content/uploads/2019/12/raspberry-pi-media-server-4.jpg" alt="Raspberry Pi Setting Up Docker"></h2>
<h2 id="introduction">Introduction</h2>
<p>This is the forth part of my Raspberry Pi Media Server series. If you havenâ€™t read our previous part, <a href="https://budimanjojo.com/raspberry-pi-media-server-series-3-external-drives/">hereâ€™s</a> where we discussed setting up external drives on Raspberry Pi. In this part, we are going to setting up <a href="https://www.docker.com/">Docker</a> on Raspberry Pi. Hereâ€™s what you will get if you follow through the end of the tutorial:</p>
<ul>
<li>Docker and Docker Compose installed</li>
<li>Docker data will be in the external drives</li>
<li><a href="https://wiki.archlinux.org/index.php/systemd">Systemd</a> will only start Docker if external drives are mounted</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<p>Before we get our hands on setting up docker on our Raspberry Pi, letâ€™s first do a system update. If you are on Manjaro, the command will be:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;sudo pacman -Syu
</code></pre><p>And if you are on Raspbian and Debianâ€™s derivatives, then the command will be:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;sudo apt update &amp;&amp; sudo upgrade
</code></pre><p>You may need to reboot your Raspberry Pi if thereâ€™s a kernel or firmware upgrade.</p>
<h2 id="installing-required-programs">Installing Required Programs</h2>
<p>The packages we need are <code>docker</code> and <code>docker-compose</code>. To do this on Manjaro ARM, itâ€™s really simple. Just do:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;sudo pacman -S docker-compose
</code></pre><p>If you are on Raspbian and Debianâ€™s derivatives, then hereâ€™s what you need to do (I copy pasted from <a href="https://withblue.ink/2019/07/13/yes-you-can-run-docker-on-raspbian.html">here</a>, thanks Alessandro Segala):</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;# Install some required packages first
sudo apt update
sudo apt install -y \
     apt-transport-https \
     ca-certificates \
     curl \
     gnupg2 \
     software-properties-common

# Get the Docker signing key for packages
curl -fsSL https://download.docker.com/linux/$(. /etc/os-release; echo &#34;$ID&#34;)/gpg | sudo apt-key add -

# Add the Docker official repos
echo &#34;deb [arch=armhf] https://download.docker.com/linux/$(. /etc/os-release; echo &#34;$ID&#34;) \
     $(lsb_release -cs) stable&#34; | \
    sudo tee /etc/apt/sources.list.d/docker.list

# Install Docker
# The aufs package, part of the &#34;recommended&#34; packages, won&#39;t install on Buster just yet, because of missing pre-compiled kernel modules.
# We can work around that issue by using &#34;--no-install-recommends&#34;
sudo apt update
sudo apt install -y --no-install-recommends \
    docker-ce \
    cgroupfs-mount
</code></pre><p>You might want to add your user to the docker group, so you donâ€™t need to use root privileges to run docker commands. Hereâ€™s the one liner, replace &lt;username&gt; with the user you are using on your Pi:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;sudo usermod -aG docker &lt;username&gt;
</code></pre><h2 id="using-external-drives-for-data">Using External Drives for Data</h2>
<p>Your docker data might be getting bigger and bigger as time goes by. That is not really a good idea to use the small and slow SD card to store them. That is why I prefer storing them in my RAID1 BTRFS external drives which I mentioned in the <a href="https://budimanjojo.com/raspberry-pi-media-server-series-3-external-drives/">previous part</a>. To do this, we will use mount binding using fstab.</p>
<p>Letâ€™s create a folder you want to bind our Docker data to. I have my external drives mounted on <code>/mnt</code>, so in my example I will create a folder <code>/mnt/docker-root</code>:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;sudo mkdir /mnt/docker-root
</code></pre><p>Also, make sure <code>/var/lib/docker</code> exists in your system. It should be there if you have started docker service (which should be automatic in Raspbian but not in Manjaro). If the folder doesnâ€™t exist, letâ€™s create it and give it a right permission:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;sudo mkdir -p /var/lib/docker &amp;&amp; sudo chmod -R 711 /var/lib/docker
</code></pre><p>Now, letâ€™s add this line into your <code>/etc/fstab</code> file (replace &lt;directory&gt; to the directory you created above, mine will be /mnt/docker-root):</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;&lt;directory&gt;                            /var/lib/docker  auto    defaults,bind,nofail                     0  0
</code></pre><p>You can now test it out by doing a <code>sudo mount -a</code> in your terminal to make sure thereâ€™s no error with your fstab file.</p>
<h2 id="optional">Optional</h2>
<p>You can tell systemd to only enable docker if your /var/lib/docker is mounted in your external drives.</p>
<p>To do this, type in:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;sudo systemctl edit docker.service
</code></pre><p>This will open up a text editor of your choice, now add these lines in the file:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;[Unit]
After=var-lib-docker.mount
Requires=var-lib-docker.mount
</code></pre><p>Save and exit. Thatâ€™s it. Systemd will not start docker service if your docker data is not mounted in your external drives.</p>
<h2 id="enable-docker">Enable Docker</h2>
<p>To start docker on startup, do:</p>
<pre tabindex="0"><code>&lt;pre class=&#34;EnlighterJSRAW&#34; data-enlighter-language=&#34;null&#34;&gt;sudo systemctl enable docker.service
</code></pre><h2 id="ending">Ending</h2>
<p>We have just finished setting up Docker in our Raspberry Pi. In the next part, we will proceed on getting our hands on setting up DNS and port forwarding our Raspberry Pi so we can access it from the outside world. Stay tuned! ðŸ™‚</p>

    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                    
                    
                    <a href="https://budimanjojo.com/tags/arm/">arm</a>
                    
                
                    
                    
                    <a href="https://budimanjojo.com/tags/docker/">docker</a>
                    
                
                    
                    
                    <a href="https://budimanjojo.com/tags/linux/">linux</a>
                    
                
                    
                    
                    <a href="https://budimanjojo.com/tags/raspberry-pi/">raspberry pi</a>
                    
                
            </div>
        </div>
    

    
</div>

</article>

        
    </div>

    
        <div id="comments-container">
            
            

            

            

        </div>
    

    </div>

    
<footer>
    <div class="container">

        
        <div class="recent-posts">
            <strong>Latest posts</strong>
            <ul>
                
                
                    <li>
                        <a href="https://budimanjojo.com/2021/12/13/managing-dotfiles-with-chezmoi/">Managing Dotfiles with chezmoi</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/11/04/gitops-home-assistant-configurations/">How I GitOps Home Assistant Configurations</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/10/28/kured-kubernetes/">Automating Kubernetes Nodes Reboot with Kured</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/10/27/variable-substitution-in-flux-gitops/">Variable Substitution in Flux GitOps</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/10/23/flux-secret-management-with-sops-age/">Flux Secret Management with SOPS age</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/10/20/how-i-manage-my-kubernetes-manifests-using-flux/">How I Manage My Kubernetes Manifests Using Flux</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2019/12/18/raspberry-pi-media-server-series-4-setting-up-docker/">Raspberry Pi Media Server Series #4 &amp;#8211; Setting Up Docker</a>
                    </li>
                
            </ul>
        </div>
        

        
        <div class="categories">
            <a href="/categories/"><strong>Categories</strong></a>
            <ul>
                
                <li>
                    <a href="/categories/linux">Linux
                        (9)</a>
                </li>
                
                <li>
                    <a href="/categories/self-hosted">Self hosted
                        (6)</a>
                </li>
                
                <li>
                    <a href="/categories/kubernetes">Kubernetes
                        (5)</a>
                </li>
                
                <li>
                    <a href="/categories/raspberry-pi">Raspberry pi
                        (4)</a>
                </li>
                
                <li>
                    <a href="/categories/terminal-stuffs">Terminal stuffs
                        (2)</a>
                </li>
                
                <li>
                    <a href="/categories/desktop-stuffs">Desktop stuffs
                        (1)</a>
                </li>
                
            </ul>
        </div>
        

        <div class="right">
            
            <div class="external-profiles">
                <strong>Social media</strong>

                
                <a href="https://github.com/budimanjojo" target="_blank"><i class="fab fa-github"></i></a>
                
                <a href="mailto:budiman@budimanjojo.com" target="_blank"><i class="fa fa-envelope"></i></a>
                
                <a href="https://www.youtube.com/channel/UCRDomXby1IfxWeTzB8xTOFA" target="_blank"><i class="fab fa-youtube"></i></a>
                
            </div>
            

            

            
        </div>
    </div>
</footer>


<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="https://github.com/budimanjojo" target="_blank">
                &copy;
                
                2022
                
                by Budiman
            </a>
            
        </div>
        <div class="author">
            <a href="https://github.com/Lednerb/bilberry-hugo-theme"
                target="_blank">Bilberry Hugo Theme</a>
        </div>
    </div>
</div>


    

    


    <script src="https://budimanjojo.com/theme.js"></script>

    
    
    

    
    <div id="activate-algolia-search" class="hidden">
  <input type="hidden" id="algolia-search-appId" value="72C1FEBFMX">
  <input type="hidden" id="algolia-search-apiKey" value="f86a032ec932c5020e3a63404a6d937e">
  <input type="hidden" id="algolia-search-indexName" value="budimanjojo_com">
  <input type="hidden" id="algolia-search-noSearchResults" value="Nothing found.">

  
  <input type="hidden" id="algolia-search-currentLanguageOnly">
  
</div>

    
</body>

</html>
