<!DOCTYPE html>


  
<html itemscope itemtype="https://schema.org/WebPage" class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="siteBaseUrl" content="https://budimanjojo.com">
    <meta name="author" content="budimanjojo">
    <meta name="description" content="Life Journey of My Geeky Needs.">
    <meta name="keywords" content="blog,personal,responsive,kubernetes,linux,gitops,fluxcd,dotfiles,cluster,container">
    <meta name="generator" content="Hugo 0.101.0" />
    <title>
        
           
               Managing Dotfiles with chezmoi &vert; Budiman JoJo
           
        
    </title>
    <meta itemprop="name" content="Managing Dotfiles with chezmoi">
    <meta itemprop="description" content="Managing Dotfiles with chezmoi - Life Journey of My Geeky Needs.">
    <meta property="og:title" content="Managing Dotfiles with chezmoi">
    <meta property="og:description" content="Managing Dotfiles with chezmoi - Life Journey of My Geeky Needs.">
    <meta property="og:image" content="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?size=200">
    <meta property="og:url" content="https://budimanjojo.com/2021/12/13/managing-dotfiles-with-chezmoi/">
    <meta property="og:site_name" content="Budiman JoJo">
    <meta property="og:type" content="article">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">


    <script src="/modernizr-simple.js"></script>

    
    <link href="/2021/12/13/managing-dotfiles-with-chezmoi/" rel="alternate" type="application/rss+xml" title="Budiman JoJo" />
    <link href="/2021/12/13/managing-dotfiles-with-chezmoi/" rel="feed" type="application/rss+xml" title="Budiman JoJo" />
    

    
    <link rel="canonical" href="https://budimanjojo.com/2021/12/13/managing-dotfiles-with-chezmoi/">
    

    <link rel="stylesheet" href="https://budimanjojo.com/theme.css">

    

    
        
    
</head>

<body class="bilberry-hugo-theme">

    
    <nav class="permanentTopNav">

    <div class="container">
        <ul class="topnav">
            
                
                    <li><a href="https://github.com/budimanjojo" target="_blank">Github</a></li>
                
            
                
                    <li><a href="/archive/" target="">Archive</a></li>
                
            
                
                    <li><a href="https://budimanjojo.com/page/about-budimanjojo/">About Me</a></li>
                
            
        </ul>

        
            <div id="search-box" class="search">
                <i class="fas fa-search"></i>
                <input id="search" type="text" placeholder="Search ...">
            </div>
        
    </div>
</nav>


    
    <header>

    <div class="container">
        <div class="logo">
            <a href="/" class="logo">
                
                    <img src="/avatar.png" alt="">
                

                <span class="overlay"><i class="fa fa-home"></i></span>
            </a>
        </div>
        <div class="titles">
            <h3 class="title">
                <a href="/">
                    Budiman JoJo
                </a>
            </h3>

            
                <span class="subtitle">Life Journey of My Geeky Needs.</span>
            
        </div>

        

        
            <div class="toggler permanentTopNav">
        
                <i class="fa fa-bars" aria-hidden="true"></i>
            </div>
    </div>
</header>


    <div class="main container">
        
    <div class="article-wrapper u-cf single">
        
            <a class="bubble" href="https://budimanjojo.com/2021/12/13/managing-dotfiles-with-chezmoi/">
    <i class="fas fa-fw fa-pencil-alt"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h1 class="article-title">
        <a href="https://budimanjojo.com/2021/12/13/managing-dotfiles-with-chezmoi/">
            Managing Dotfiles with chezmoi
        </a>
    </h1>

    <div class="meta">
        
            
                <span class="date moment">2021-12-13</span>
            
        

        
            
                <span class="readingTime">7 min read</span>
            
        

        
            <span class="categories">
                
                    
                    
                        <a href="https://budimanjojo.com/categories/desktop-stuffs/">Desktop Stuffs</a>
                    
                
                    
                    
                        <a href="https://budimanjojo.com/categories/linux/">Linux</a>
                    
                
                    
                    
                        <a href="https://budimanjojo.com/categories/terminal-stuffs/">Terminal Stuffs</a>
                    
                
            </span>
        

        
            <span class="author">
                
                
                    <a href="https://budimanjojo.com/author/budimanjojo/">budimanjojo</a>
                
            </span>
        
    </div>

    
        

        <p><img src="/wp-content/uploads/2021/12/chezmoi-e1639414532178.png" alt="managing-dotfiles-with-chezmoi"></p>
<p>The biggest difference between my setup and your setup might be our configuration files. In Unix world we call them dotfiles. Dotfiles are just files whose filename starts with a dot and will be hidden by default in our file managers.</p>
<p>Usually we have several machines that we use consequently, and we want all those machines to share the same environment. And that’s why most most people will have have own collection of dotfiles stored somewhere so they can easily migrate them over to their new machine.</p>
<p>This could be easily achieved without having any software, you can just store them in your Github repository right? Right, but not everything will go as you want it to be. Here’s my take on what problem you might encounter:</p>
<ul>
<li>Sometimes you have different versions of programs that needs changes in the dotfiles</li>
<li>You don’t want your secrets like credentials etc in a git repository unencrypted</li>
<li>You need to do something on your brand new computers before you can use those dotfiles</li>
<li>The path where those dotfiles should be are different across machines</li>
</ul>
<p>You may have more problem than I can think of right now. But in my experience, <a href="https://github.com/twpayne/chezmoi">chezmoi</a> covers everything. Please note that this is not a step by step tutorial on how to use chezmoi because it’s a very complex program and you’ll need a lot of readings. You can start from the easy to follow <a href="https://github.com/twpayne/chezmoi/tree/master/docs">official documentation</a> to get started. This post is more about me sharing how I’m managing my dotfiles with chezmoi.</p>
<h2 id="background">Background</h2>
<p>I have been using Linux as my primary OS since 2012. And I had my first dotfile was like a year after using Linux when I switched to use <a href="https://www.zsh.org/">ZSH</a> as my default shell. I don’t remember how I managed them back then, but from my dotfiles <a href="https://github.com/budimanjojo/dotfiles/graphs/contributors">repository timeline</a> I first created that repo in June 2014. I started out by symlinking my dotfiles from git repository into my <code>$HOME</code> directory, to having an install script written in bash, to having <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html">ansible-playbook</a>, to using chezmoi.</p>
<p>From my experience all this years, I can feel how much chezmoi helped me in managing my dotfiles, and I want to share it.</p>
<h2 id="installing-chezmoi">Installing chezmoi</h2>
<p>The first thing you need to do before starting to use chezmoi is of course installing the program itself. There are a <a href="https://github.com/twpayne/chezmoi/blob/master/docs/INSTALL.md">lot of ways to install chezmoi</a>, but I like the put them in a <a href="https://github.com/budimanjojo/dotfiles/blob/master/install.sh">script</a>. So I can just run one command like this to install chezmoi:</p>
<pre tabindex="0"><code>curl https://raw.githubusercontent.com/budimanjojo/dotfiles/master/install.sh | bash
</code></pre><p>Once installed, you can create a repository in Github or Gitlab or any other similar tools to host your git repository. To simplify using chezmoi, I suggest you to name your repository <code>dotfiles</code>. Once done, you can run <code>chezmoi init &lt;your remote repository username&gt;</code> and you can start adding your dotfiles with <code>chezmoi add</code> command.</p>
<h2 id="understanding-the-concept">Understanding the Concept</h2>
<p>Chezmoi is very different from other dotfiles manager tools out there, it might be confusing at first. Especially if you used to use the traditional ways like symlinking or using <a href="https://www.gnu.org/software/stow/">stow</a>.</p>
<p>What you need to know is, try to use <code>chezmoi</code> command as much as you can. For example, to add your <a href="https://github.com/alacritty/alacritty">Alacritty</a> config, you do <code>chezmoi add ~/.config/alacritty/alacritty.yml</code>. This will create the file in your repository with this path: <code>dot_config/alacritty/alacritty.yml</code>. You can then do git add, commit, and push the changes to your remote repository. On your other machine, you can then install and init chezmoi, then do <code>chezmoi apply</code> to copy your Alacritty config into your new machine.</p>
<p>In summary, you do <code>chezmoi init</code> command once, then add files into your repository with <code>chezmoi add</code>. Once you have everything added, in your new machine you simply do <code>chezmoi apply</code> and everything will be applied to your new machine. Also, there is <code>chezmoi update</code> command to update your local repository to match your remote repository. I suggest you to <a href="https://www.chezmoi.io/docs/reference/#completion-shell">setup chezmoi completion</a> for your favorite shell so you can start managing dotfiles with chezmoi be easier.</p>
<h2 id="what-is-the-difference-from-other-tools">What Is the Difference From Other Tools</h2>
<p>I can see you guys might be asking what is the difference from other tools. You can look at this <a href="https://github.com/twpayne/chezmoi/blob/master/docs/COMPARISON.md#comparison-table">comparison table</a>. For me, chezmoi have everything you may or may not have. It’s like combination of all the other dotfiles managers out there that do everything. Here are the features that I’m currently using intensively.</p>
<h3 id="1-templating">1. Templating</h3>
<p>This is by far one of the features that I love so much when using chezmoi. To add a template in chezmoi, you can use <code>--template</code> flag when doing the <code>add</code> command like this: <code>chezmoi add --template ~/.gitconfig</code>. This command will create a <code>dot_gitconfig.tmpl</code> file in your repo that you can start templating. What’s the use case of this? A lot, I mean really a lot. You can use it to change a value of a dotfile according to hostname, OS, etc.</p>
<p>When you do chezmoi init, it will create a set of variables that you can use. You can look at them by doing <code>chezmoi data</code> command, it’s similar to what <code>ansible facts</code> is. You can also add your own “data” using chezmoi <a href="https://github.com/twpayne/chezmoi/blob/master/docs/REFERENCE.md#configuration-file">config file</a>.</p>
<p>I use template for things machine specific config, for example I want my terminal font to be size 12 in my main machine, but I want it to be size 14 in my work machine. I also use it to disable something when it doesn’t match some conditions, for example I want to load <code>kubectl</code> command completion when I’m at my work machine but not on my home machine.</p>
<h3 id="2-ignore-file">2. Ignore File</h3>
<p>You can also add a file named <code>.chezmoiignore</code> in your repository and chezmoi will ignore the files listed inside. It’s like <code>.gitignore</code> file, but the patterns you put inside should match the <code>source</code> file and not the <code>destination</code> file. Usually you put your <code>README.md</code> or <code>LICENSE</code> in here so they don’t get into your <code>$HOME</code> directory. But the great thing about this file is you can also do templating inside it. I use this to ignore files base on conditions, for example I ignore window manager specific dotfiles when the machine is headless etc.</p>
<h3 id="3-scripts">3. Scripts</h3>
<p>Now this is another powerful feature from chezmoi, scripting. You can add scripts anywhere in your repository or put them in <code>.chezmoiscripts</code> directory. The filename has to starts with <code>run_</code> and ends with <code>.tmpl</code>. Basically these scripts will run everytime you do <code>chezmoi apply</code> command, but you can tell it to run once per machine or only run when there are changes. You can also specify whether the scripts should be run before or after copying the dotfiles. For example, to have the script run once before updating the dotfiles, create the filename like this: <code>run_once_before_&lt;do something&gt;.sh.tmpl</code>.<br>
There’s one thing you need to be aware of, chezmoi will run these scripts using <code>exec</code> command. So you need to make sure you provide <code>&lt;a href=&quot;https://bash.cyberciti.biz/guide/Shebang&quot;&gt;shebang&lt;/a&gt;</code> inside the file. Also, try to make those scripts as <a href="https://en.wikipedia.org/wiki/Idempotence">idempotent</a> as you can so it doesn’t do the same thing over and over again whenever you run <code>chezmoi apply</code>.</p>
<p>I use this feature to do packages installation, setting up shell, downloading something, etc.</p>
<h3 id="4-encrypted-secrets">4. Encrypted Secrets</h3>
<p>Another feature of chezmoi is the ability to put encrypted dotfiles in your public repository safely. Chezmoi supports whole file encryption using <a href="https://github.com/FiloSottile/age">age</a> or value encryption using password managers. I don’t use password manager yet so I can’t say much about this. But I use the whole file encryption with age and it works fine. If you want to have a glimpse on what age is, I have a post about <a href="https://budimanjojo.com/2021/10/23/flux-secret-management-with-sops-age/">how I use SOPS and age to encrypt my kubernetes secrets</a>.</p>
<p>To actually create encrypted dotfile using age with chezmoi, you need to have this section in your chezmoi config file:</p>
<pre tabindex="0"><code>encryption: age
age:
  identity: &lt;path to file with your age private key&gt;
  recipient: &lt;string of your age public key&gt;
</code></pre><p>Then you can simply do <code>chezmoi add --encrypted &lt;filepath&gt;</code> to create an encrypted file in your repository. Chezmoi will decrypt the file on your other machine before applying them using the same age private key. You might want to have age private key inside your new machine first.</p>
<h2 id="ending">Ending</h2>
<p>I think this should wrap all the things I want to share about chezmoi. It’s so much more you can do with chezmoi but I really don’t want this blogpost to be any longer. And this is how I’m managing dotfiles with chezmoi. Feel free to leave some comments if you have any suggestion or question. Also check out my <a href="https://github.com/budimanjojo/dotfiles">dotfiles</a> repository if you want to look at how I implement chezmoi.</p>
    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                    
                    
                    <a href="https://budimanjojo.com/tags/chezmoi/">chezmoi</a>
                    
                
                    
                    
                    <a href="https://budimanjojo.com/tags/dotfiles/">dotfiles</a>
                    
                
            </div>
        </div>
    

    
</div>

</article>

        
    </div>

    
        <div id="comments-container">
            
            

            
    <script src="https://giscus.app/client.js"
        data-repo="budimanjojo/site"
        data-repo-id="R_kgDOH1yWAQ"
        data-category="General"
        data-category-id="DIC_kwDOH1yWAc4CQ6Px"
        data-mapping="title"
        data-reactions-enabled="1"
        data-emit-metadata=""
        data-theme="light_tritanopia"
        
            data-lang="en"
        
        crossorigin="anonymous"
        async>
    </script>
    <div id="giscus"></div>


            

        </div>
    

    </div>

    
<footer>
    <div class="container">

        
        <div class="recent-posts">
            <strong>Latest posts</strong>
            <ul>
                
                
                    <li>
                        <a href="https://budimanjojo.com/2021/12/13/managing-dotfiles-with-chezmoi/">Managing Dotfiles with chezmoi</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/11/04/gitops-home-assistant-configurations/">How I GitOps Home Assistant Configurations</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/10/28/kured-kubernetes/">Automating Kubernetes Nodes Reboot with Kured</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/10/27/variable-substitution-in-flux-gitops/">Variable Substitution in Flux GitOps</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/10/23/flux-secret-management-with-sops-age/">Flux Secret Management with SOPS age</a>
                    </li>
                
                    <li>
                        <a href="https://budimanjojo.com/2021/10/20/how-i-manage-my-kubernetes-manifests-using-flux/">How I Manage My Kubernetes Manifests Using Flux</a>
                    </li>
                
            </ul>
        </div>
        

        
        <div class="categories">
            <a href="/categories/"><strong>Categories</strong></a>
            <ul>
                
                <li>
                    <a href="/categories/linux">Linux
                        (9)</a>
                </li>
                
                <li>
                    <a href="/categories/self-hosted">Self hosted
                        (6)</a>
                </li>
                
                <li>
                    <a href="/categories/kubernetes">Kubernetes
                        (5)</a>
                </li>
                
                <li>
                    <a href="/categories/raspberry-pi">Raspberry pi
                        (4)</a>
                </li>
                
                <li>
                    <a href="/categories/terminal-stuffs">Terminal stuffs
                        (2)</a>
                </li>
                
                <li>
                    <a href="/categories/desktop-stuffs">Desktop stuffs
                        (1)</a>
                </li>
                
            </ul>
        </div>
        

        <div class="right">
            
            <div class="external-profiles">
                <strong>Social media</strong>

                
                <a href="https://github.com/budimanjojo" target="_blank"><i class="fab fa-github"></i></a>
                
                <a href="mailto:budiman@budimanjojo.com" target="_blank"><i class="fa fa-envelope"></i></a>
                
                <a href="https://www.youtube.com/channel/UCRDomXby1IfxWeTzB8xTOFA" target="_blank"><i class="fab fa-youtube"></i></a>
                
            </div>
            

            

            
        </div>
    </div>
</footer>


<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="https://github.com/budimanjojo" target="_blank">
                &copy;
                
                2022
                
                by budimanjojo
            </a>
            
        </div>
        <div class="author">
            <a href="https://github.com/Lednerb/bilberry-hugo-theme"
                target="_blank">Bilberry Hugo Theme</a>
        </div>
    </div>
</div>


    

    


    <script src="https://budimanjojo.com/theme.js"></script>

    
    
    

    
    <div id="activate-algolia-search" class="hidden">
  <input type="hidden" id="algolia-search-appId" value="72C1FEBFMX">
  <input type="hidden" id="algolia-search-apiKey" value="f86a032ec932c5020e3a63404a6d937e">
  <input type="hidden" id="algolia-search-indexName" value="budimanjojo_com">
  <input type="hidden" id="algolia-search-noSearchResults" value="Nothing found.">

  
</div>

    
</body>

</html>
